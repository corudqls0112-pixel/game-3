<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>성경 카드 게임 시리즈</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    font-family: Arial, sans-serif;
    background: #f0f8ff;
    flex-direction: column;
    padding: 20px;
  }
  h1 {
    text-align: center;
    margin-bottom: 10px;
  }
  p {
    margin-bottom: 20px;
  }
  .card-container {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }
  .card {
    width: 200px;
    height: 120px;
    perspective: 1000px;
    cursor: grab;
    margin-bottom: 10px;
  }
  .card-inner {
    width: 100%;
    height: 100%;
    transition: transform 0.6s;
    transform-style: preserve-3d;
    border-radius: 10px;
  }
  .card.flipped .card-inner {
    transform: rotateY(180deg);
  }
  .card-front, .card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 10px;
    backface-visibility: hidden;
  }
  .card-front {
    background: #1e90ff;
    color: white;
  }
  .card-back {
    background: #ffffff;
    color: #333;
    transform: rotateY(180deg);
    border: 2px solid #1e90ff;
  }
  #nextMessage {
    margin-top: 20px;
    font-size: 1.2rem;
    color: green;
    display: none;
    text-align: center;
  }
</style>
</head>
<body>

<h1 id="gameTitle">성경 카드 게임</h1>
<p id="gameDesc">카드를 클릭하여 내용을 확인하고, 올바른 순서대로 정렬하세요.</p>

<div class="card-container" id="cardContainer"></div>

<div id="nextMessage"></div>

<script>
// === 게임 데이터 정의 ===
const games = [
  {
    title: "고린도전서 1:17 카드 게임",
    description: "카드를 클릭하여 내용을 확인하고, 올바른 순서대로 정렬하세요.",
    cards: [
      "그리스도께서 나를 보내심은",
      "세례를 베풀게 하려 하심이 아니요",
      "오직 복음을 전하게 하려 하심이로되",
      "말의 지혜로 하지 아니함은",
      "그리스도의 십자가가 헛되지 않게 하려 함이라"
    ],
    verse: "1:17" // 장:절 표시
  },
  {
    title: "시편 133:1 카드 게임",
    description: "카드를 클릭하여 내용을 확인하고, 올바른 순서대로 정렬하세요.",
    cards: [
      "보라 형제가 연합하여 동거함이",
      "얼마나 선하고",
      "얼마나 아름다운가",
      "여호와께서 그 복을 명하셨도다"
    ],
    verse: "133:1"
  }
];

let currentGameIndex = 0;
let correctOrder = [];
let passwordHint = "";
const container = document.getElementById("cardContainer");
const nextMessage = document.getElementById("nextMessage");
const gameTitle = document.getElementById("gameTitle");
const gameDesc = document.getElementById("gameDesc");

// === 카드 생성 함수 ===
function shuffleArray(array) {
  for (let i = array.length -1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i +1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function createCards() {
  container.innerHTML = "";
  nextMessage.style.display = 'none';
  const currentGame = games[currentGameIndex];
  gameTitle.textContent = currentGame.title;
  gameDesc.textContent = currentGame.description;

  correctOrder = [...currentGame.cards];

  // passwordHint 누적
  passwordHint += currentGame.verse.replace(":", "");

  const shuffledTexts = shuffleArray([...currentGame.cards]);

  shuffledTexts.forEach((text, index) => {
    const card = document.createElement("div");
    card.className = "card";
    card.draggable = true;
    card.dataset.index = index;
    card.innerHTML = `
      <div class="card-inner">
        <div class="card-front">뒤집기</div>
        <div class="card-back">${text}</div>
      </div>
    `;
    // 카드 클릭 뒤집기
    card.addEventListener("click", () => card.classList.toggle("flipped"));
    // 드래그 이벤트
    card.addEventListener('dragstart', dragStart);
    card.addEventListener('dragover', dragOver);
    card.addEventListener('drop', drop);
    card.addEventListener('dragend', dragEnd);
    container.appendChild(card);
  });
}

// === 드래그 앤 드롭 ===
let dragSrcEl = null;

function dragStart(e) {
  dragSrcEl = this;
  this.style.opacity = '0.5';
}

function dragOver(e) {
  e.preventDefault();
}

function drop(e) {
  e.stopPropagation();
  if (dragSrcEl !== this) {
    const nodes = Array.from(container.children);
    const srcIndex = nodes.indexOf(dragSrcEl);
    const destIndex = nodes.indexOf(this);
    if (srcIndex < destIndex) {
      container.insertBefore(dragSrcEl, this.nextSibling);
    } else {
      container.insertBefore(dragSrcEl, this);
    }
    checkOrder();
  }
}

function dragEnd(e) {
  this.style.opacity = '1';
}

// === 순서 체크 ===
function checkOrder() {
  const currentOrder = Array.from(container.children)
    .map(card => card.querySelector(".card-back").textContent);

  if (currentOrder.join() === correctOrder.join()) {
    nextMessage.style.display = 'block';
    nextMessage.textContent = "정답! 잠시 후 다음 게임으로 이동합니다...";
    if (currentGameIndex + 1 < games.length) {
      setTimeout(() => {
        currentGameIndex++;
        createCards();
      }, 1000);
    } else {
      // 마지막 게임 완료
      setTimeout(() => {
        nextMessage.textContent = "축하합니다! 모든 카드를 맞추셨습니다.\n힌트: 지금까지 이어붙인 성경 구절 장과 절을 조합하면 비밀번호입니다.\n비밀번호 힌트: " + passwordHint;
      }, 1000);
    }
  } else if (currentOrder.length === correctOrder.length) {
    nextMessage.style.display = 'none';
    setTimeout(() => {
      alert("틀렸습니다! 카드가 다시 섞입니다.");
      createCards();
    }, 500);
  }
}

// === 초기 카드 생성 ===
createCards();
</script>

</body>
</html>
